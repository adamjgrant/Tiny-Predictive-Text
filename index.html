<!DOCTYPE HTML>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<h2>Tiny Predictive Text
<br><small>Experiment using sentence fingerprinting</small></h2>
<p>Press <strong>Tab</strong> to autocomplete with suggestion.<br>
   Press <strong>Shift</strong> to change the suggestion</p>
<div id="suggestion">...</div>
 
<textarea id="entry" placeholder="Start typing"></textarea>
<p>
  <br>Context string: <code><span id="cs-layer1">...</span> --> <span id="cs-layer2">...</span> --> <span id="cs-layer3">...</span> --> <span id="cs-layer4">...</span></code>
</p>

<p>
  <div class="color_box" style="background-color: rgb(187, 246, 187)"></div> Light green = Good.<br>
  <div class="color_box" style="background-color: #00cc00"></div> Green = Better<br>
  <div class="color_box" style="background-color: darkgreen"></div> Dark green = Best<br>
  <div class="color_box" style="background-color: #EEEEEE;"></div> White = Matching within prediction<br>
  <div class="color_box" style="background-color: cornflowerblue;"></div> Blue = Idle
</p>
<script type="module" src="tinypredict.js"></script>
<script>
  const suggestion_element = document.getElementById('suggestion');
  const set_suggestion_element = () => {
    if (predictions_on_deck.length === 0) {
      suggestion_element.innerHTML = '...';
      return;
    }
    suggestion_element.innerHTML = predictions_on_deck[0];
  }

  let predictions_on_deck = [];

  const completeSuggestion = () => {
    if (predictions_on_deck.length === 0) {
      return;
    }
    const entry = document.getElementById('entry');
    entry.value += predictions_on_deck[0] + " ";
    predictions_on_deck = [];
    set_suggestion_element();
  }

  window.addEventListener('tinypredict-ready', () => {
    const entry = document.getElementById('entry');
    entry.addEventListener("keydown", function(event) {
      if (event.key === "Tab") {
        event.preventDefault();
        completeSuggestion();
      }
    });
    entry.addEventListener("keyup", function(event) {
      const input = event.target.value;
      if (event.key === "Shift") {
        event.preventDefault();
        console.log(predictions_on_deck);
        predictions_on_deck.push(predictions_on_deck.shift());
        console.log(predictions_on_deck);
        set_suggestion_element();
      }
      else {
        window.getPredictiveText(input).then(suggestions => {
          console.log(suggestions.prediction); // Process or display the suggestions
          predictions_on_deck = suggestions.prediction;
          set_suggestion_element();
        });
      }
    });
  });
</script>
