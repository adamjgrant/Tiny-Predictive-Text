class Tree{constructor(e){this.object=e}get one(){return this.translated_branch.one()}get permutations(){return this.translated_branch.terminal_leaves()}get translated_branch(){return new Branch(this,this.translate_main)}get translate_main(){return new Branch(this,this.object.main).translate_object}branch(e){return this.object[e]||[]}get unique_branch_name(){let e=Object.keys(this.object).reduce((e,t)=>t.length>e?t:e,""),t=`${e}-${Date.now()}`;return this.object[t]=[],t}}class Branch{constructor(e,t,n){this.tree=e,this.object=t,this.then_branches=n}terminal_leaves(e=""){return this.branches().length?this.leaves().reduce((t,n)=>t.concat(this.branches().reduce((t,a)=>t.concat(new Branch(this.tree,a).terminal_leaves(`${e}${n}`)),[])),[]):this.leaves().map(t=>`${e}${t}`)}one(e=""){let t=`${e}${this.leaves(!0)}`;return this.branches().length?new Branch(this.tree,this.branches(!0)).one(t):t}leaves(e=!1){let t=this.object.filter(e=>new Leaf(e).is_string)||[],n=t.length?t:[""];return e?n[~~(n.length*Math.random())]:n}branches(e=!1){let t=new Leaf(this.object);t.is_directive&&(this.object=[this.translate_directive(t)]),t.is_string&&(this.object=[this.object]);let n=this.object.filter(e=>new Leaf(e).is_branch);return e?n[~~(n.length*Math.random())]:n}translate_directive(e){return e.has_directive("branch")?this.translate_branch_reference(e):e.has_directive("ps")?this.translate_ps_reference(e):void 0}get translate_object(){let e=new Leaf(this.object);return e.is_directive?this.translate_directive(e):(this.is_terminal_branch&&void 0!==this.then_branches&&this.object.push(this.then_branches),this.object.map(e=>{let t=new Leaf(e);if(t.has_directive("branch"))return this.translate_branch_reference(t);if(t.has_directive("ps"))return this.translate_ps_reference(t);if(t.is_branch){let n=new Branch(this.tree,t.node);return n.is_terminal_branch||(n.then_branches=this.then_branches),n.translate_object}return t.node}))}get is_terminal_branch(){return!(this.branches().length&&void 0!==this.then_branches)&&this.object.every(e=>new Leaf(e).is_string)}translate_branch_reference(e){let t=this.duplicate_branch(this.tree.branch(e.node.branch)),n=new Branch(this.tree,t,this.then_branches);if(e.has_directive("then")){let a=this.translate_then_reference(e);n.prepend_then_branch(a)}return n.translate_object}translate_then_reference(e){let t=e.node.then;return"String"===t.constructor.name&&(t=[t]),new Branch(this.tree,t).translate_object}translate_ps_reference(e){return new PermyScript(e.node.ps).compile}duplicate_branch(e){return JSON.parse(JSON.stringify(e))}prepend_then_branch(e){if(void 0!==e){let t=new Branch(this.tree,e,this.then_branches).translate_object;return this.is_terminal_branch?this.object=this.deep_end(e):this.prepend_to_non_terminal_branch(t)}}prepend_to_non_terminal_branch(e){let t=this.object.filter(e=>!new Leaf(e).is_string).map(t=>{let n=new Branch(this.tree,t,this.then_branches).translate_object,a=this.duplicate_branch(this.tree.object),r=this.tree.unique_branch_name;return a.main={branch:r,then:e},a[r]=n,new Tree(a).translate_main});return this.object=[...this.leaves(),...t]}deep_end(e){if(!this.branches().length)return this.object.push(e),this.object;let t=this.branches().map(t=>{let n=new Branch(this.tree,t);return n.deep_end(e),n.object});return this.object=[...this.leaves(),...t]}}class Leaf{constructor(e){this.node=e}get is_branch(){return Array.isArray(this.node)}get is_string(){return"String"===this.node.constructor.name}get is_directive(){return this.has_directive("branch")||this.has_directive("ps")}has_directive(e="branch"){return"object"==typeof this.node&&void 0!==this.node[e]}}class PermyScript{constructor(e){this.string=e,this.tree_object={main:[]},this.last_unique_branch_name="0"}get unique_branch_name(){return this.last_unique_branch_name=String(parseInt(this.last_unique_branch_name)+1),this.last_unique_branch_name}get break_into_parts(){let e=[],t=this.string.split("");return t.reduce((n,a,r)=>a.match(/\(/)?(e.push(n),a):a.match(/\)/)?(e.push(n+a),""):r!==t.length-1?n+a:void e.push(n+a),""),this.tree_object.main=e,this}get convert_parens(){return this.tree_object.main=this.tree_object.main.map(e=>new Part(e)),this}get delegate_to_branches(){let e=new Tree({main:[]});return this.tree_object.main.forEach(t=>{if(t.is_directive){let n=this.unique_branch_name;e.object[n]=t.branch,e=new Tree(e.object);let a=e.translated_branch;a.deep_end({branch:n}),e.object.main=a.object,e=new Tree(e.object)}else{let r=e.translated_branch;"[]"===JSON.stringify(r.object)?r=new Branch(e,t.branch):r.deep_end(t.branch),e.object.main=r.object,e=new Tree(e.object)}}),this.tree_object=e.object,this}get compile(){return new Tree(this.break_into_parts.convert_parens.delegate_to_branches.tree_object).translate_main}}class Part{constructor(e){this.string=e}get is_directive(){return"("===this.string.substr(0,1)&&")"===this.string.substring(this.string.length,this.string.length-1)}get branch(){return this.string.replace(/[()]/g,"").split("|")}}const tree={main:[{branch:"the"},{branch:"be"},{branch:"to"},{branch:"of"},{branch:"and"},{branch:"a"},{branch:"in"},{branch:"that"},{branch:"have"},{branch:"i"},{branch:"it"},{branch:"for"},{branch:"not"},{branch:"on"},{branch:"with"},{branch:"he"},{branch:"as"},{branch:"you"},{branch:"do"},{branch:"at"},{branch:"this"},{branch:"but"},{branch:"his"},{branch:"by"},{branch:"from"}],the:[["the ",[["world ",["is ","has ","seems "]],["time ",["passes ","for ","to "]],["best ",["option ","choice ","way "]],["first ",["step ","time ","place "]],["most ",["important ","common ","likely "]]]]],be:[["be ",[["sure ",["to ","that ","of "]],["aware ",["of ","that ","in "]],["careful ",["when ","with ","about "]],["prepared ",["for ","to ","by "]],["ready ",["for ","to ","with "]]]]],to:[["to ",[["be ",["sure ","prepared ","able "]],["have ",["a ","the ","an "]],["see ",["that ","if ","how "]],["do ",["this ","that ","it "]],["go ",["to ","ahead ","on "]]]]],of:[["of ",[[{branch:"the"},[["world ",["is ","has ","knows "]],["best ",["choice ","option ","idea "]],["most ",["important ","relevant ","significant "]]]],[{branch:"our"},[["time ",["is ","was ","can be "]],["efforts ",["are ","will be ","have been "]],["community ",["is ","supports ","needs "]]]],["a ",[["new ",["era ","beginning ","chapter "]],["great ",["opportunity ","advantage ","benefit "]],["significant ",["change ","impact ","role "]]]],["this ",[["is ","was ","can be "]],["case ",["involves ","requires ","presents "]],["situation ",["demands ","calls for ","entails "]]]],["that ",[["is ","was ","can be "]],["can ",["help ","support ","improve "]],["will ",["change ","define ","influence "]]]]],and:[["and ",[[{branch:"the"},[["world ",["is ","has ","knows "]],["best ",["choice ","option ","idea "]],["most ",["important ","relevant ","significant "]]]],["a ",[["new ",["era ","beginning ","chapter "]],["great ",["opportunity ","advantage ","benefit "]],["significant ",["change ","impact ","role "]]]],["in ",[["the ",["middle ","heart ","depths "]],["a ",["sense ","world ","manner "]],["our ",["lives ","times ","history "]]]],["to ",[["the ",["point ","extent ","degree "]],["a ",["greater ","lesser ","similar "]],["our ",["advantage ","benefit ","interest "]]]],["with ",[["the ",["aim ","goal ","purpose "]],["a ",["clear ","defined ","specific "]],["one ",["goal ","objective ","aim "]]]]]]],a:[["a ",[["new ",["chapter ","era ","beginning "]],["great ",["opportunity ","success ","achievement "]],["small ",["step ","change ","amount "]],["large ",["scale ","amount ","number "]],["young ",["individual ","person ","talent "]]]]],in:[["in ",[[{branch:"the"},[["beginning ",["of ","with ","to "]],["end ",["of ","with ","to "]],["middle ",["of ","with ","to "]]]],["a ",[["moment ",["of ","like ","as "]],["sense ",["of ","that ","in "]],["world ",["of ","like ","as "]]]],["that ",[["moment ",["when ","where ","as "]],["case ",["when ","where ","as "]],["time ",["when ","where ","as "]]]],["this ",[["case ",["involves ","requires ","presents "]],["situation ",["demands ","calls for ","entails "]],["moment ",["captures ","represents ","signifies "]]]],[{branch:"our"},[["community ",["supports ","needs ","values "]],["society ",["reflects ","demands ","challenges "]],["world ",["changes ","evolves ","adapts "]]]]]]],that:[["that ",[["is ",["true ","possible ","important "]],["was ",["necessary ","inevitable ","required "]],["can ",["be ","do ","make "]],["will ",["be ","do ","make "]],["should ",["be ","do ","consider "]]]]],have:[["have ",[["been ",["working ","trying ","looking "]],["a ",[["lot ",["of ","to do ","going on "]],["bit ",["more ","less ","of "]],["great deal ",["of ","to offer ","going for it "]]]],[{branch:"the"},[["ability ",["to ","and ","but "]],["opportunity ",["to ","and ","but "]],["chance ",["to ","and ","but "]]]],["no ",[["doubt ",["that ","in ","about "]],["idea ",["of ","about ","how "]],["clue ",["about ","to ","why "]]]],["some ",[["time ",["to ","for ","on "]],["kind ",["of ","to ","for "]],["sort ",["of ","to ","for "]]]]]]],i:[["i ",[["am ",["excited ","ready ","prepared "]],["have ",["seen ","experienced ","understood "]],["think ",["that ","about ","it's "]],["want ",["to ","a ","the "]],["know ",["that ","about ","how "]]]]],it:[["it ",[["is ",["important ","necessary ","crucial "]],["was ",["a ","the ","an "]],["has ",["been ","a ","the "]],["can ",["be ","do ","achieve "]],["will ",["be ","do ","achieve "]]]]],for:[["for ",[["the ",["first time ","most part ","sake of "]],["a ",["moment ","while ","change "]],["this ",["reason ","purpose ","project "]],["that ",["reason ","purpose ","occasion "]],["an ",["example ","opportunity ","alternative "]]]]],not:[["not ",[["only ",["is it ","does it ","can it "]],["to ",["mention ","forget ","overlook "]],["be ",["ignored ","overlooked ","considered "]],["just ",["a ","the ","an "]],["so ",["much ","little ","important "]]]]],on:[["on ",[["the ",["other hand ","contrary ","whole "]],["a ",["daily basis ","regular basis ","clear day "]],["this ",["topic ","matter ","subject "]],["that ",["note ","day ","occasion "]],["one ",["hand ","side ","level "]]]]],with:[["with ",[["the ",["help ","assistance ","support "]],["a ",["few ","little ","bit of "]],["this ",["in mind ","approach ","strategy "]],["that ",["being said ","in mind ","considered "]],["one ",["another ","look ","goal in mind "]]]]],he:[["he ",[["is ",["a great ","an experienced ","a talented "]],["was ",["known as ","regarded as ","considered "]],["has ",["been ","a ","the "]],["can ",["be ","do ","achieve "]],["will ",["be ","do ","achieve "]]]]],as:[["as ",[["the ",["world turns ","sun sets ","day goes "]],["a ",["result ","matter of fact ","whole "]],["an ",["example ","illustration ","aside "]],["well ",["known ","established ","respected "]],["much ",["as ","to ","so as to "]]]]],you:[["you ",[["are ",["the best ","amazing ","capable "]],["have ",["the ability ","the option ","the opportunity "]],["can ",["see ","do ","achieve "]],["will ",["be ","do ","achieve "]],["should ",["consider ","remember ","know "]]]]],do:[["do ",[["not ",["forget ","hesitate ","worry "]],["you ",["know ","understand ","remember "]],["we ",["have ","need ","want "]],["they ",["know ","understand ","see "]],["i ",["need ","want ","wish "]]]]],at:[["at ",[["the ",["end ","beginning ","heart "]],["a ",["glance ","minimum ","maximum "]],["this ",["time ","moment ","point "]],["that ",["time ","moment ","point "]],["one ",["time ","point ","moment "]]]]],this:[["this ",[["is ",["a new ","an important ","a critical "]],["was ",["a turning point ","an example ","a case "]],["can ",["be ","serve as ","represent "]],["has ",["been ","a ","the "]],["will ",["be ","do ","achieve "]]]]],but:[["but ",[["the ",["truth is ","fact remains ","reality is "]],["a ",["few ","little ","bit of "]],["it ",["is ","was ","remains "]],["this ",["is ","was ","can be "]],["that ",["is ","was ","can be "]]]]],his:[["his ",[["own ",["experience ","decision ","choice "]],["life ",["is ","was ","has been "]],["work ",["has ","is ","continues "]],["name ",["is ","was ","remains "]],["family ",["is ","was ","has been "]]]]],by:[["by ",[["the ",["time ","way ","end "]],["a ",["stroke of genius ","simple act ","mere fact "]],["this ",["means ","point ","logic "]],["that ",["time ","standard ","measure "]],["an ",["act ","example ","effort "]]]]],from:[["from ",[["the ",["beginning ","first moment ","get-go "]],["a ",["different perspective ","distance ","standpoint "]],["this ",["point ","perspective ","angle "]],["that ",["day ","moment ","time "]],["an ",["early stage ","initial phase ","early point "]]]]]};let suggested_text_on_deck="";const[entry,suggestion]=[document.getElementById("entry"),document.getElementById("suggestion")],get_word=()=>{let e=entry.value.trim().split(" ");return e[e.length-1].toLowerCase()},clear_suggestion=()=>{suggestion.innerHTML="...",suggested_text_on_deck=""},get_suggestion=e=>{let t=tree[e=e.replace(/[\s\:\.\,]/g,"")];return t?(0,new Tree({main:t[0][1]}).one):""};entry.addEventListener("keydown",e=>{if(9===e.keyCode){e.preventDefault();let t=" "===entry.value.split("").reverse()[0]?"":" ";entry.value=entry.value+t+suggested_text_on_deck,clear_suggestion()}}),entry.addEventListener("keyup",()=>{let e=get_word();if(""===e)return clear_suggestion();console.log(e);let t=get_suggestion(e);if(!t)return clear_suggestion();suggested_text_on_deck=t,suggestion.innerHTML=t});